'use strict';(function($){var OpalListingRating={init:function(){this.single.init();$(document).on('click','.opallisting-toggle-review',this.toggleReview);$(document).on('click','.opallisting-toggle-helpful',this.toggleLikeComment);},toggleReview:function(e){e.preventDefault();var self=$(this);var wrapper=$('#opallisting-reviews');var sections=wrapper.find('.review-section');var current=self.parents('.review-section:first');var next=self.attr('href');current.slideUp(400,function(){$(next).removeClass('hide').slideDown();});return false;},toggleLikeComment:function(e){e.preventDefault();var self=$(this);var data=self.data();$.ajax({url:opallistingJS.ajaxurl,type:'POST',data:data,beforeSend:function(){if(typeof $.fn.button=='function'){}else{self.addClass('processing');}}}).always(function(){if(typeof $.fn.button=='function'){}else{self.removeClass('processing');}}).done(function(res){if(typeof res.status=='undefined')return;if(typeof res.liked!=='undefined'){if(res.liked){self.addClass('active');}else{self.removeClass('active');}}if(typeof res.count!=='undefined'){self.find('.count').text(res.count);}});return false;},single:{init:function(){var _doc=$(document);this.review();_doc.on('submit','.opallisting-comment-form',this.submit_review);},review:function(){var reviews=$('.opallisting-star');for(var i=0;i<reviews.length;i++){var _review=$(reviews[i]),type=_review.attr('data-type'),html=[];html.push('<p>');if(type!==undefined){html.push('<span class="star-wrapper" data-type="'+type+'">');}else{html.push('<span class="star-wrapper">');}html.push('<span href="#" class="star" data-star="1"></span>');html.push('<span href="#" class="star" data-star="2"></span>');html.push('<span href="#" class="star" data-star="3"></span>');html.push('<span href="#" class="star" data-star="4"></span>');html.push('<span href="#" class="star" data-star="5"></span>');if(type!==undefined){html.push('<input type="hidden" name="opallisting_rating['+type+']" />');}else{html.push('<input type="hidden" name="opallisting_rating" />');}html.push('</span>');html.push('</p>');_review.append(html.join(''));_review=_review.find('.star-wrapper');_review.mousemove(function(e){e.preventDefault();var parentOffset=$(this).offset(),relX=e.pageX-parentOffset.left,star=$(this).find('.star'),width=star.width(),rate=Math.ceil(relX/width);for(var y=0;y<star.length;y++){var st=$(star[y]),_data_star=parseInt(st.attr('data-star'));if(_data_star<=rate){st.addClass('active');}}}).mouseout(function(e){var parentOffset=$(this).offset(),relX=e.pageX-parentOffset.left,star=$(this).find('.star'),width=star.width(),rate=$(this).find('.star.selected');if(rate.length===0){star.removeClass('active');}else{for(var y=0;y<star.length;y++){var st=$(star[y]),_data_star=parseInt(st.attr('data-star'));if(_data_star<=parseInt(rate.attr('data-star'))){st.addClass('active');}else{st.removeClass('active');}}}}).mousedown(function(e){e.preventDefault();var parentOffset=$(this).offset(),relX=e.pageX-parentOffset.left,star=$(this).find('.star'),width=star.width(),type=$(this).attr('data-type'),rate=Math.ceil(relX/width);star.removeClass('selected').removeClass('active');for(var y=0;y<star.length;y++){var st=$(star[y]),_data_star=parseInt(st.attr('data-star'));if(_data_star===rate){st.addClass('selected').addClass('active');break;}else{st.addClass('active');}}if(type===undefined){$(this).find('input[name="opallisting_rating"]').val(rate);}else{$(this).find('input[name="opallisting_rating['+type+']"]').val(rate);}});}},submit_review:function(e){var form=$(this),_rating=form.find('input[name^="opallisting_rating"]'),button=form.find('.submit'),loadingTemplate=wp.template('opallisting-loading')({});if(typeof OpalListingComment.option_require_rating!=='undefined'&&typeof OpalListingComment.option_enabled_rating!=='undefined'&&OpalListingComment.option_enabled_rating=='1'&&OpalListingComment.option_require_rating=='1'){var rated=true;for(var i=0;i<_rating.length;i++){var __rate=$(_rating[i]);if(__rate.val()===''){rated=false;}}if(rated===false){alert(OpalListingComment.require_rating);return false;}}if(form.parents('.mfp-content').length>0){if(typeof $.fn.button!=='undefined'){button.button('loading');}$.ajax({url:opallistingJS.ajaxurl,type:'POST',data:form.serializeArray(),beforeSend:function(){form.addClass('processing');form.find('.has-error').removeClass('has-error');form.append(loadingTemplate);}}).always(function(){form.removeClass('processing');if(typeof $.fn.button!=='undefined'){button.button('reset');}form.find('.opallisting-loading').remove();}).done(function(res){if(typeof res.status==='undefined'){return;}if(res.status===false&&typeof res.fields!=='undefined'&&res.fields.length>0){for(var i=0;i<res.fields.length;i++){var input=form.find('[name="'+res.fields[i]+'"]').parents('.form-row:first').addClass('has-error');}}if(typeof res.message!=='undefined'){form.append(res.message);}if(res.status===true){form.find('input[type="text"], input[type="email"], input[type="tel"], textarea').val('');window.location.reload();}else{form.find('.opallisting-messages').delay(2000).queue(function(){$(this).remove();});}});return false;}return true;}}};$(document).ready(function(){OpalListingRating.init();});})(jQuery);